version: 1.0.{build}
configuration:
- Debug
- Release
platform: Any CPU
environment:
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
cache: '%USERPROFILE%\.nuget\packages'
before_build:
- cmd: dotnet restore
- ps: >-
    Get-ChildItem -Path $ENV:APPVEYOR_BUILD_FOLDER -Recurse â€“File -Filter project.json | foreach {
      $jsonFile = Get-Content $_.FullName -raw | ConvertFrom-Json
      if($jsonFile.version)
      {
          $jsonFile.version = $ENV:APPVEYOR_BUILD_VERSION
          $jsonFile | ConvertTo-Json -Depth 999 | Out-File $_.FullName
      }
    }
build:
  verbosity: normal
after_build:
- dotnet pack "src\utes.Xunit" -c %CONFIGURATION% --no-build --version-suffix %APPVEYOR_BUILD_VERSION% -o artifacts
test_script:
- ps: >-
    dotnet test ".\tests\utes.Core.Tests" -c $ENV:CONFIGURATION

    dotnet test ".\tests\utesutes.WebApplicationAssemblyStorage.Tests" -c $ENV:CONFIGURATION
artifacts:
- path: artifacts\**\*.*
